<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Th·ªß Thi√™m Garden 3D - Qu·∫£n l√Ω CƒÉn h·ªô Th√¥ng minh</title>
    <link rel="shortcut icon" href="favicon.png" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="fonts/icomoon/style.css" />
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />

    <link rel="stylesheet" href="css/tiny-slider.css" />
    <link rel="stylesheet" href="css/aos.css" />
    <link rel="stylesheet" href="css/style.css" />

    <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />

    <style>
        .section-3d-map {
            padding: 50px 0;
            background: #f8f9fa;
        }
        
        /* Khung ch·ª©a b·∫£n ƒë·ªì */
        .map-container {
            height: 600px; 
            position: relative; 
            overflow: hidden; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border: 1px solid #dee2e6;
        }

        #viewDiv {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0; left: 0;
            z-index: 1;
        }
    </style>
  </head>
  <body>

    <div class="site-mobile-menu site-navbar-target">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close">
          <span class="icofont-close js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>

    <nav class="site-nav">
      <div class="container">
        <div class="menu-bg-wrap">
          <div class="site-navigation">
            <a href="index.html" class="logo m-0 float-start">TT Garden 3D</a>
              <ul class="js-clone-nav d-none d-lg-flex align-items-center text-start site-menu float-end">
                <li class="active"><a href="index.html">Trang ch·ªß</a></li>
                <li><a href="#section-3d-map">M√¥ h√¨nh 3D</a></li>
                <li><a href="#properties-section">Danh s√°ch CƒÉn h·ªô</a></li>
                <li><a href="contact.html">Li√™n h·ªá</a></li>
                <li>
                  <a href="#" class="btn btn-primary text-white px-3 py-2" data-bs-toggle="modal" data-bs-target="#loginModal" style="border-radius: 20px;">
                    üë§ ƒêƒÉng nh·∫≠p
                    </a>
                </li>
              </ul>
            <a href="#" class="burger light me-auto float-end mt-1 site-menu-toggle js-menu-toggle d-inline-block d-lg-none" data-toggle="collapse" data-target="#main-navbar">
              <span></span>
            </a>
          </div>
        </div>
      </div>
    </nav>

    <div class="hero">
      <div class="hero-slide">
        <div class="img overlay" style="background-image: url('images/hero_bg_3.jpg')"></div>
        <div class="img overlay" style="background-image: url('images/hero_bg_2.jpg')"></div>
        <div class="img overlay" style="background-image: url('images/hero_bg_1.jpg')"></div>
      </div>
      <div class="container">
        <div class="row justify-content-center align-items-center">
          <div class="col-lg-9 text-center">
            <h1 class="heading" data-aos="fade-up">Th·ªß Thi√™m Garden<br>N∆°i cu·ªôc s·ªëng thƒÉng hoa</h1>
            <p data-aos="fade-up" data-aos-delay="200" class="text-white">Tr·∫£i nghi·ªám c√¥ng ngh·ªá xem nh√† 3D Digital Twin ƒë·∫ßu ti√™n t·∫°i khu v·ª±c</p>
            <p data-aos="fade-up" data-aos-delay="300"><a href="#section-3d-map" class="btn btn-primary">Kh√°m ph√° Ngay</a></p>
          </div>
        </div>
      </div>
    </div>

    <section class="features-1">
      <div class="container">
        <div class="row">
          <div class="col-6 col-lg-3" data-aos="fade-up" data-aos-delay="300">
            <div class="box-feature">
              <span class="flaticon-house"></span>
              <h3 class="mb-3">CƒÉn h·ªô Th√¥ng minh</h3>
              <p>Thi·∫øt k·∫ø hi·ªán ƒë·∫°i, t·ªëi ∆∞u di·ªán t√≠ch.</p>
            </div>
          </div>
          <div class="col-6 col-lg-3" data-aos="fade-up" data-aos-delay="400">
            <div class="box-feature">
              <span class="flaticon-building"></span>
              <h3 class="mb-3">V·ªã tr√≠ V√†ng</h3>
              <p>Trung t√¢m k·∫øt n·ªëi khu ƒê√¥ng S√†i G√≤n.</p>
            </div>
          </div>
          <div class="col-6 col-lg-3" data-aos="fade-up" data-aos-delay="500">
            <div class="box-feature">
              <span class="flaticon-house-3"></span>
              <h3 class="mb-3">An ninh 24/7</h3>
              <p>H·ªá th·ªëng b·∫£o v·ªá ƒëa l·ªõp an to√†n tuy·ªát ƒë·ªëi.</p>
            </div>
          </div>
          <div class="col-6 col-lg-3" data-aos="fade-up" data-aos-delay="600">
            <div class="box-feature">
              <span class="flaticon-house-1"></span>
              <h3 class="mb-3">H·ªì b∆°i Tr√†n b·ªù</h3>
              <p>Th∆∞ gi√£n ƒë·ªânh cao v·ªõi view th√†nh ph·ªë.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="section-3d-map" id="section-3d-map" style="padding: 0; background: #fff;">
        
        <div class="map-container" style="width: 100%; height: 85vh; position: relative; border-bottom: 5px solid #005555;">
            <div id="viewDiv" style="width: 100%; height: 100%;"></div>
            
            <div style="position:absolute; top:20px; right:20px; background:rgba(255,255,255,0.8); padding:10px; border-radius:4px; font-size:12px; z-index:2;">
                <i class="flaticon-3d-cube"></i> Gi·ªØ chu·ªôt ph·∫£i ƒë·ªÉ xoay 3D
            </div>
        </div>

<div class="search-bar-container" style="background: #f8f9fa; padding: 30px 0; border-bottom: 1px solid #ddd;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-12">
                <form class="row g-3 align-items-end p-4 bg-white shadow-sm rounded">
                    <div class="col-12 mb-3">
                        <h5 class="text-primary font-weight-bold"><i class="icon-search"></i> T√¨m ki·∫øm CƒÉn h·ªô</h5>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold small">Block</label>
                        <select id="selBlock" class="form-select">
                            <option value="All">T·∫•t c·∫£ Block</option>
                            <option value="A">Block A</option>
                            <option value="B">Block B</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold small">T·∫ßng</label>
                        <select id="selFloor" class="form-select">
                            <option value="All">T·∫•t c·∫£ t·∫ßng</option>
                            <option value="1">T·∫ßng 1</option>
                            <option value="2">T·∫ßng 2</option>
                            <option value="3">T·∫ßng 3</option>
                            <option value="4">T·∫ßng 4</option>
                            <option value="5">T·∫ßng 5</option>
                            <option value="6">T·∫ßng 6</option>
                            <option value="7">T·∫ßng 7</option>
                            <option value="8">T·∫ßng 8</option>
                            <option value="9">T·∫ßng 9</option>
                            <option value="10">T·∫ßng 10</option>
                            <option value="11">T·∫ßng 11</option>
                            <option value="12">T·∫ßng 12</option>
                            <option value="14">T·∫ßng 14</option>
                            <option value="15">T·∫ßng 15</option>
                            <option value="16">T·∫ßng 16</option>
                            <option value="17">T·∫ßng 17</option>
                            <option value="18">T·∫ßng 18</option>
                        </select>
                    </div>

                    <div class="col-md-2">
                        <label class="form-label fw-bold small">Lo·∫°i cƒÉn h·ªô</label>
                        <select id="selType" class="form-select">
                            <option value="All">T·∫•t c·∫£</option>
                            <option value="1">1 Ph√≤ng ng·ªß</option>
                            <option value="2">2 Ph√≤ng ng·ªß</option>
                            <option value="3">3 Ph√≤ng ng·ªß</option>
                        </select>
                    </div>

                    <div class="col-md-2">
                        <label class="form-label fw-bold small">T√¨nh tr·∫°ng</label>
                        <select id="selStatus" class="form-select">
                            <option value="All">T·∫•t c·∫£</option>
                            <option value="0">üü¢ C√≤n tr·ªëng</option>
                            <option value="1">üî¥ ƒê√£ thu√™</option>
                        </select>
                    </div>

                    <div class="col-md-2">
                    <button type="button" id="btnFilter" class="btn btn-primary w-100 fw-bold" onclick="window.applyFilter()">
                          L·ªåC K·∫æT QU·∫¢
                    </button>
                    </div>
                    
                    <div class="col-12 text-center mt-2">
                        <small id="resCount" class="text-muted fst-italic">Vui l√≤ng ch·ªçn ti√™u ch√≠ v√† b·∫•m L·ªçc...</small>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

    <div class="section" id="properties-section">
      <div class="container">
        <div class="row mb-5 align-items-center">
          <div class="col-lg-6">
            <h2 class="font-weight-bold text-primary heading">K·∫øt qu·∫£ T√¨m ki·∫øm</h2>
          </div>
          <div class="col-lg-6 text-lg-end">
            <p>Danh s√°ch chi ti·∫øt c√°c cƒÉn h·ªô ph√π h·ª£p</p>
          </div>
        </div>
        
        <div class="row" id="resultList">
            <div class="col-12 text-center text-muted py-5">
                <h5>Vui l√≤ng ch·ªçn ti√™u ch√≠ v√† b·∫•m "L·ªçc k·∫øt qu·∫£" ƒë·ªÉ xem danh s√°ch.</h5>
            </div>
        </div>
      </div>
    </div>

    <div class="site-footer">
      <div class="container">
        <div class="row">
          <div class="col-lg-4">
            <div class="widget">
              <h3>Li√™n h·ªá BQL</h3>
              <address>ƒê∆∞·ªùng Li√™n Ph∆∞·ªùng, P. Ph∆∞·ªõc Long B, TP. Th·ªß ƒê·ª©c</address>
              <ul class="list-unstyled links">
                <li><a href="tel://11234567890">+84 909 123 456</a></li>
                <li><a href="mailto:info@thuthiemgarden.com">info@thuthiemgarden.com</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="widget">
              <h3>V·ªÅ D·ª± √°n</h3>
              <ul class="list-unstyled float-start links">
                <li><a href="#">T·ªïng quan</a></li>
                <li><a href="#">V·ªã tr√≠</a></li>
                <li><a href="#">Ti·ªán √≠ch</a></li>
                <li><a href="#">Ch√≠nh s√°ch</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-4">
             <div class="widget">
                <h3>K·∫øt n·ªëi</h3>
                <ul class="list-unstyled social">
                    <li><a href="#"><span class="icon-facebook"></span></a></li>
                    <li><a href="#"><span class="icon-twitter"></span></a></li>
                    <li><a href="#"><span class="icon-instagram"></span></a></li>
                </ul>
             </div>
          </div>
        </div>
        <div class="row mt-5">
          <div class="col-12 text-center">
            <p>Copyright &copy; 2024 Th·ªß Thi√™m Garden 3D Project.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title font-weight-bold mx-auto text-primary">ƒêƒÉng Nh·∫≠p H·ªá Th·ªëng</h5>
          </div>
          <div class="modal-body">
            <form id="loginForm">
              <div class="mb-3">
                <input type="text" class="form-control" id="loginUser" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
              </div>
              <div class="mb-3">
                <input type="password" class="form-control" id="loginPass" placeholder="M·∫≠t kh·∫©u" required>
              </div>
              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary font-weight-bold">ƒêƒÉng nh·∫≠p</button>
                <button type="button" class="btn btn-light text-muted" data-bs-dismiss="modal">T√¥i l√† Kh√°ch v√£ng lai</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="apartmentModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg"> <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title font-weight-bold" id="modalTitle">Th√¥ng tin cƒÉn h·ªô</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
                <div class="col-md-7">
                    <div id="carouselApartment" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner" id="modalCarouselInner">
                            <div class="carousel-item active"><img src="images/img_1.jpg" class="d-block w-100" alt="..."></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5">
                    <h3 class="text-primary font-weight-bold" id="modalPrice">...</h3>
                    <p class="text-muted" id="modalCode">M√£ cƒÉn: ...</p>
                    <hr>
                    <ul class="list-unstyled">
                        <li class="mb-2"><strong>Di·ªán t√≠ch:</strong> <span id="modalArea">...</span> m¬≤</li>
                        <li class="mb-2"><strong>Ph√≤ng ng·ªß:</strong> <span id="modalBeds">...</span> PN</li>
                        <li class="mb-2"><strong>H∆∞·ªõng:</strong> <span id="modalDirection">ƒê√¥ng Nam</span></li>
                        <li class="mb-2"><strong>Tr·∫°ng th√°i:</strong> <span id="modalStatus">...</span></li>
                    </ul>
                    <hr>
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-primary" id="btnContactFromModal">üìû LI√äN H·ªÜ THU√ä NGAY</button>
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                    </div>
                </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="consultModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Li√™n h·ªá thu√™ cƒÉn h·ªô <span id="targetAptCode"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="consultForm">
                        <input type="hidden" id="consultAptId">
                        <div class="mb-3">
                            <label>H·ªç t√™n c·ªßa b·∫°n</label>
                            <input type="text" class="form-control" id="cName" required>
                        </div>
                        <div class="mb-3">
                            <label>S·ªë ƒëi·ªán tho·∫°i</label>
                            <input type="tel" class="form-control" id="cPhone" required>
                        </div>
                        <div class="mb-3">
                            <label>Email (n·∫øu c√≥)</label>
                            <input type="email" class="form-control" id="cEmail">
                        </div>
                        <div class="mb-3">
                            <label>Ghi ch√∫ th√™m</label>
                            <textarea class="form-control" id="cNote" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-success w-100">G·ª≠i th√¥ng tin</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/tiny-slider.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/counter.js"></script>
    <script src="js/custom.js"></script>

    <script src="https://js.arcgis.com/4.29/"></script>
    <script type="module" src="./src/main.js"></script>

    <script>
        // ===========================================
        // 1. X·ª¨ L√ù ƒêƒÇNG NH·∫¨P (LOGIN)
        // ===========================================
        document.getElementById("loginForm").addEventListener("submit", async function(e){
            e.preventDefault();
            const u = document.getElementById("loginUser").value;
            const p = document.getElementById("loginPass").value;

            try {
                const res = await fetch('http://localhost:3000/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: u, password: p })
                });
                
                const data = await res.json();
                
                if(data.success) {
                    localStorage.setItem('user_role', data.role);
                    localStorage.setItem('user_name', data.name);
                    localStorage.setItem('user_code', data.code);
                    localStorage.setItem('user_username', u); // L∆∞u ƒë·ªÉ d√πng cho ƒë·ªïi pass
                    if (data.res_id) localStorage.setItem('user_res_id', data.res_id);

                    alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng! Xin ch√†o " + data.name);
                    
                    if(data.role === 'admin') window.location.href = "admin.html";
                    else if(data.role === 'resident') window.location.href = "resident.html";
                    else location.reload(); 
                } else {
                    alert("‚ùå L·ªói: " + data.message);
                }
            } catch(err) { console.error(err); alert("Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c Server!"); }
        });

        // ===========================================
        // 3. X·ª¨ L√ù MODAL T∆Ø V·∫§N & G·ª¨I FORM
        // ===========================================
// 1. H√†m m·ªü Modal (Gi·ªØ nguy√™n logic g√°n ID)
        window.openConsultModal = function(aptId, aptCode) {
        // G√°n ID v√† M√£ cƒÉn v√†o th·∫ª ·∫©n ƒë·ªÉ khi g·ª≠i bi·∫øt l√† kh√°ch ch·ªçn cƒÉn n√†o
        const idInput = document.getElementById('hdnAptId');
        const codeLabel = document.getElementById('lblConsultCode');
        
        if(idInput) idInput.value = aptId;
        if(codeLabel) codeLabel.innerText = aptCode;
        
        // Reset form
        if(document.getElementById('txtCusName')) document.getElementById('txtCusName').value = "";
        if(document.getElementById('txtCusPhone')) document.getElementById('txtCusPhone').value = "";
        
        // M·ªü Modal
        const modalEl = document.getElementById('consultModal'); // ƒê·∫£m b·∫£o ID modal ƒë√∫ng l√† 'consultModal'
        if(modalEl) {
            const myModal = new bootstrap.Modal(modalEl);
            myModal.show();
        } else {
            console.error("Kh√¥ng t√¨m th·∫•y Modal c√≥ id='consultModal' trong HTML");
        }
    };

    // 2. H√†m G·ª≠i D·ªØ Li·ªáu (QUAN TR·ªåNG: G·ªçi API m·ªõi)
        async function submitConsultation() {
        // L·∫•y d·ªØ li·ªáu t·ª´ c√°c √¥ input (ƒê·∫£m b·∫£o ID trong HTML kh·ªõp v·ªõi c√°c d√≤ng n√†y)
        const payload = {
            apt_id: document.getElementById('hdnAptId').value,
            name: document.getElementById('txtCusName').value,
            phone: document.getElementById('txtCusPhone').value,
            email: document.getElementById('txtCusEmail').value || "", // Email c√≥ th·ªÉ ƒë·ªÉ tr·ªëng
            note: document.getElementById('txtCusNote') ? document.getElementById('txtCusNote').value : ""
        };

        if(!payload.name || !payload.phone) {
            alert("Vui l√≤ng ƒëi·ªÅn T√™n v√† S·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ ch√∫ng t√¥i li√™n h·ªá!");
            return;
        }

        try {
            // G·ªçi API /api/consultations m√† ta v·ª´a th√™m v√†o server.js
            const res = await fetch('http://localhost:3000/api/consultations', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await res.json();
            
            if(data.success) {
                alert("‚úÖ G·ª≠i th√†nh c√¥ng! B·ªô ph·∫≠n kinh doanh s·∫Ω li√™n h·ªá b·∫°n s·ªõm.");
                // ·∫®n modal sau khi g·ª≠i xong
                const modalEl = document.getElementById('consultModal');
                const modalInstance = bootstrap.Modal.getInstance(modalEl);
                if(modalInstance) modalInstance.hide();
            } else {
                alert("L·ªói: " + data.message);
            }
        } catch(e) { 
            console.error(e);
            alert("L·ªói k·∫øt n·ªëi Server! H√£y ch·∫Øc ch·∫Øn b·∫°n ƒë√£ ch·∫°y 'node server.js'"); 
        }
    }
    </script>
    
  </body>
</html>